<!DOCTYPE html>
<html lang="es">
<%- include('../partials/head') %>
<body>
  <%- include('../partials/header') %>

  <main>
    <h2>Login de Usuario</h2>

    <form id="formLogin" action="/users/login" method="POST">
      <!-- Email -->
      <div class="form-group">
        <label for="email">Email</label>
        <input
          type="email"
          name="email"
          id="email"
          value="<%= old.email ? old.email : '' %>"
        >
        <% if (errors.email) { %>
          <small class="field-error"><%= errors.email.msg %></small>
        <% } %>
        <!-- Error de credenciales incorrectas -->
        <% if (errors.credentials) { %>
          <small class="field-error"><%= errors.credentials.msg %></small>
        <% } %>
        <small class="frontend-error" id="errorEmail"></small>
      </div>

      <!-- Contraseña -->
      <div class="form-group">
        <label for="password">Contraseña</label>
        <input
          type="password"
          name="password"
          id="password"
        >
        <% if (errors.password) { %>
          <small class="field-error"><%= errors.password.msg %></small>
        <% } %>
        <small class="frontend-error" id="errorPassword"></small>
      </div>

      <!-- Checkbox “Recuérdame” (opcional) -->
      <div class="form-group">
        <label>
          <input type="checkbox" name="remember" id="remember" >
          Recuérdame
        </label>
      </div>

      <button type="submit" class="btn">Ingresar</button>
    </form>
  </main>

  <%- include('../partials/footer') %>

  <!-- Validación front‐end para login -->
  <script>
    document.getElementById('formLogin').addEventListener('submit', function(e) {
      document.getElementById('errorEmail').innerText = '';
      document.getElementById('errorPassword').innerText = '';

      let hasErrors = false;
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      // Email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        document.getElementById('errorEmail').innerText = 'Debes ingresar un email válido';
        hasErrors = true;
      }

      // Contraseña no vacía
      if (password === '') {
        document.getElementById('errorPassword').innerText = 'La contraseña es obligatoria';
        hasErrors = true;
      }

      if (hasErrors) {
        e.preventDefault();
      }
    });
  </script>
</body>
</html>
