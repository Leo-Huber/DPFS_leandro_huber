<!DOCTYPE html>
<html lang="es">
<%- include('../partials/head') %>
<body>
  <%- include('../partials/header') %>

  <main>
    <h2>Registro de Usuario</h2>

    <form id="formRegister" action="/users/register" method="POST" enctype="multipart/form-data">
      <!-- Nombre -->
      <div class="form-group">
        <label for="firstName">Nombre</label>
        <input
          type="text"
          name="firstName"
          id="firstName"
          value="<%= old.firstName ? old.firstName : '' %>"
        >
        <% if (errors.firstName) { %>
          <small class="field-error"><%= errors.firstName.msg %></small>
        <% } %>
        <small class="frontend-error" id="errorFirstName"></small>
      </div>

      <!-- Apellido -->
      <div class="form-group">
        <label for="lastName">Apellido</label>
        <input
          type="text"
          name="lastName"
          id="lastName"
          value="<%= old.lastName ? old.lastName : '' %>"
        >
        <% if (errors.lastName) { %>
          <small class="field-error"><%= errors.lastName.msg %></small>
        <% } %>
        <small class="frontend-error" id="errorLastName"></small>
      </div>

      <!-- Email -->
      <div class="form-group">
        <label for="email">Email</label>
        <input
          type="email"
          name="email"
          id="email"
          value="<%= old.email ? old.email : '' %>"
        >
        <% if (errors.email) { %>
          <small class="field-error"><%= errors.email.msg %></small>
        <% } %>
        <small class="frontend-error" id="errorEmail"></small>
      </div>

      <!-- Contraseña -->
      <div class="form-group">
        <label for="password">Contraseña</label>
        <input
          type="password"
          name="password"
          id="password"
        >
        <% if (errors.password) { %>
          <small class="field-error"><%= errors.password.msg %></small>
        <% } %>
        <small class="frontend-error" id="errorPassword"></small>
      </div>

      <!-- Avatar -->
      <div class="form-group">
        <label for="avatar">Avatar (opcional)</label>
        <input type="file" name="avatar" id="avatar" accept=".jpg,.jpeg,.png,.gif">
        <% if (errors.avatar) { %>
          <small class="field-error"><%= errors.avatar.msg %></small>
        <% } %>
      </div>

      <button type="submit" class="btn">Registrarme</button>
    </form>
  </main>

  <%- include('../partials/footer') %>

  <!-- JavaScript de validación front‐end -->
  <script>
    document.getElementById('formRegister').addEventListener('submit', function(e) {
      // Limpiamos mensajes previos
      document.getElementById('errorFirstName').innerText = '';
      document.getElementById('errorLastName').innerText = '';
      document.getElementById('errorEmail').innerText = '';
      document.getElementById('errorPassword').innerText = '';

      let hasErrors = false;

      // Validar Nombre
      const firstName = document.getElementById('firstName').value.trim();
      if (firstName.length < 2) {
        document.getElementById('errorFirstName').innerText = 'El nombre debe tener al menos 2 caracteres';
        hasErrors = true;
      }

      // Validar Apellido
      const lastName = document.getElementById('lastName').value.trim();
      if (lastName.length < 2) {
        document.getElementById('errorLastName').innerText = 'El apellido debe tener al menos 2 caracteres';
        hasErrors = true;
      }

      // Validar Email con regex simple
      const email = document.getElementById('email').value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        document.getElementById('errorEmail').innerText = 'Debes ingresar un email válido';
        hasErrors = true;
      }

      // Validar Contraseña
      const password = document.getElementById('password').value;
      if (password.length < 8) {
        document.getElementById('errorPassword').innerText = 'La contraseña debe tener al menos 8 caracteres';
        hasErrors = true;
      }

      if (hasErrors) {
        e.preventDefault();
      }
    });
  </script>
</body>
</html>
